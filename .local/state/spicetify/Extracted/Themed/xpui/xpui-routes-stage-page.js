"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[5523],{3203:(e,t,a)=>{a.d(t,{k:()=>r});var s=a(30758),n=a(91604);function r(){const e=(0,n.t)(),[t,a]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let t=!0;return e.getVersionInfo().then(e=>{t&&a(e)}),()=>{t=!1}},[e,a]),t}},43712:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ne});var s=a(30758),n=a(85387),r=a(40904),i=a(91198),o=a(54091),l=a(67012),c=a(80128),u=a(3203);var d=a(99091),g=a(57304),h=a(51956),S=a.n(h);let E=null;const T=(0,a(64175).h)();function I(e){const t=(0,d.S)(e=>e.setStatus),[a,n]=(0,s.useState)(""),r=(0,s.useCallback)(async()=>{if(e){t(g.Z.AUTHENTICATION_STARTED);const a=await f(e).catch(e=>{throw(E||(E=h.logger),E).error("error: could not fetch IDT token!"),t(g.Z.AUTHENTICATION_FAILED),e});a&&(t(g.Z.AUTHENTICATION_SUCCEEDED),n(a.accessToken))}},[e,t]);return(0,s.useEffect)(()=>{e&&r()},[e,r]),a}async function f(e){if(!e)return;const t=new URL("sp://auth/v1/token_web_auth");return t.searchParams.append("audience",e),await T.get(t.toString())}var b=a(27360),N=a(24189);var p=a(62411),C=a(58248);var w=a(21090);function y(e,t){const a=(0,s.useRef)(),n=function(){const e=(0,s.useRef)(),t=(0,d.S)(e=>e.setStatus),a=(0,s.useCallback)(()=>{t(g.Z.PAGE_LOAD_STARTED),e.current=setTimeout(()=>{S().error("[The Stage] Message handshake timeout (5s)"),t(g.Z.PAGE_LOAD_FAILED)},5e3)},[t]),n=(0,s.useCallback)(()=>{clearTimeout(e.current)},[]),r=(0,s.useCallback)(()=>{t(g.Z.PAGE_LOAD_SUCCEEDED),n()},[t,n]);return(0,s.useMemo)(()=>({handleStarted:a,handleClear:n,handleCompleted:r}),[n,r,a])}(),r=function(){const e=(0,C.g)(),t=(0,p.d4)(e=>e.ui.history.canGoBack);return(0,s.useCallback)(()=>{e(t?-1:"/")},[e,t])}(),i=(()=>{const e=(0,d.S)(e=>e.setStatus),{enqueueSnackbar:t}=(0,N.d)(),a=(0,s.useCallback)(()=>{t(o.Ru.get("feedback.link-copied")),e(g.Z.SHARE_EVENT)},[t,e]),n=(0,s.useCallback)(a=>{t(o.Ru.get("error.generic")),e(g.Z.ERROR)},[t,e]);return(0,s.useMemo)(()=>({onSuccess:a,onError:n}),[a,n])})(),l=(()=>{const e=(0,d.S)(e=>e.setStatus),t=(0,d.S)(e=>e.setMessage);return{handleWebEvent:(0,s.useCallback)(a=>{t(a),e(g.Z.WEB_EVENT)},[t,e])}})(),c=(0,s.useCallback)(s=>{if(!e.includes(s.origin))return;const o=JSON.parse(s.data);"didRequestInitialize"===o.type?(a.current={source:s.source,options:{targetOrigin:s.origin}},function(e){const{source:t,options:a}=e,s=JSON.stringify({type:"ready",capabilities:{}});t.postMessage(s,a)}(a.current),n.handleCompleted()):"didRequestIDToken"===o.type?(a.current={source:s.source,options:{targetOrigin:s.origin}},async function(e,t){const{source:a,options:s}=e,n=await f(t);if(!n)return;if(!n.accessToken)return;const r=JSON.stringify({type:"didReceiveIDToken",token:n.accessToken});a.postMessage(r,s)}(a.current,t)):"didRequestClose"===o.type?r():"didRequestShare"===o.type?async function(e,t,a){const{source:s,options:n}=e;if("didRequestShare"!==t.type)return;let r;const i=(0,b.o_h)(t.url);i&&(r=i.toURL());await(0,w.l)(r).catch(e=>{throw a.onError(e),e}),a.onSuccess();const o={type:"didDismissShare",requestId:t.requestId};s.postMessage(JSON.stringify(o),n)}(a.current,o,i):"didSendEvent"===o.type&&function(e,t){if("didSendEvent"!==e.type)return;const a={category:e.category,action:e.action,label:e.label,value:e.value};t.handleWebEvent(a)}(o,l)},[e,t,n,r,i,l]);(0,s.useEffect)(()=>(window.addEventListener("message",c),n.handleStarted(),()=>{window.removeEventListener("message",c),n.handleClear()}),[c,n])}var k=a(1812),D=a(40903);let m=function(e){return e[e.NONE=0]="NONE",e[e.STT=1]="STT",e[e.IDT=2]="IDT",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});function O(e){switch(e){case 0:case"NONE":return m.NONE;case 1:case"STT":return m.STT;case 2:case"IDT":return m.IDT;default:return m.UNRECOGNIZED}}let A=function(e){return e[e.INVALID=0]="INVALID",e[e.VALID=1]="VALID",e[e.ACTIVE=2]="ACTIVE",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});function L(e){switch(e){case 0:case"INVALID":return A.INVALID;case 1:case"VALID":return A.VALID;case 2:case"ACTIVE":return A.ACTIVE;default:return A.UNRECOGNIZED}}let R=function(e){return e[e.ALCOHOL=0]="ALCOHOL",e[e.ENERGY_DRINKS=1]="ENERGY_DRINKS",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});const v={fromJSON:e=>({id:P(e.id)?globalThis.String(e.id):"0",campaignId:P(e.campaignId)?globalThis.String(e.campaignId):"0",lookupToken:P(e.lookupToken)?globalThis.String(e.lookupToken):"",url:P(e.url)?globalThis.String(e.url):"",authType:P(e.authType)?O(e.authType):0,clientId:P(e.clientId)?globalThis.String(e.clientId):void 0,hasAudio:!!P(e.hasAudio)&&globalThis.Boolean(e.hasAudio),status:P(e.status)?L(e.status):0,restricted:!!P(e.restricted)&&globalThis.Boolean(e.restricted),gcpProjectId:P(e.gcpProjectId)?globalThis.String(e.gcpProjectId):"",defaultLocale:P(e.defaultLocale)?globalThis.String(e.defaultLocale):"",restrictions:globalThis.Array.isArray(e?.restrictions)?e.restrictions.map(e=>function(e){switch(e){case 0:case"ALCOHOL":return R.ALCOHOL;case 1:case"ENERGY_DRINKS":return R.ENERGY_DRINKS;default:return R.UNRECOGNIZED}}(e)):[],enableLegacySharing:!!P(e.enableLegacySharing)&&globalThis.Boolean(e.enableLegacySharing),hidePlayer:!!P(e.hidePlayer)&&globalThis.Boolean(e.hidePlayer),legacyBackBehavior:!!P(e.legacyBackBehavior)&&globalThis.Boolean(e.legacyBackBehavior),enableCheckout:!!P(e.enableCheckout)&&globalThis.Boolean(e.enableCheckout),allowedCountries:globalThis.Array.isArray(e?.allowedCountries)?e.allowedCountries.map(e=>globalThis.String(e)):[],restoreOnKilled:!!P(e.restoreOnKilled)&&globalThis.Boolean(e.restoreOnKilled),enableMediaDevices:!!P(e.enableMediaDevices)&&globalThis.Boolean(e.enableMediaDevices)})},_={fromJSON:e=>({site:P(e.site)?v.fromJSON(e.site):void 0})};function P(e){return null!=e}var Z=a(38895);const G={fromJSON:e=>({id:U(e.id)?globalThis.String(e.id):"0",siteId:U(e.siteId)?globalThis.String(e.siteId):"0",title:U(e.title)?globalThis.String(e.title):"",description:U(e.description)?globalThis.String(e.description):"",previewImageUrl:U(e.previewImageUrl)?globalThis.String(e.previewImageUrl):"",locale:U(e.locale)?globalThis.String(e.locale):"",height:U(e.height)?globalThis.Number(e.height):void 0,width:U(e.width)?globalThis.Number(e.width):void 0})},M={fromJSON:e=>({metadata:U(e.metadata)?G.fromJSON(e.metadata):void 0})};function U(e){return null!=e}var V=a(78969);const B=18e5,J=6e5,q={all:["vtec"],sites:()=>[...q.all,"site"],site:e=>[...q.sites(),e],siteMetadata:(e,t)=>[...q.site(e),t]},K=e=>{const{onStart:t,onError:a,onSuccess:s}=(()=>{const e=(0,d.S)(e=>e.setStatus);return{onStart:()=>{e(g.Z.RESOLVING_SITE_STARTED)},onSuccess:()=>e(g.Z.RESOLVING_SITE_SUCCEEDED),onError:t=>{e(g.Z.RESOLVING_SITE_FAILED)}}})(),{data:n,error:r,isPending:i,isSuccess:l}=(0,k.I)({queryKey:q.site(e),queryFn:async()=>(t(),await(async(e,t)=>await e.build().withHost(`${Z.sp}`).withMethod("GET").withoutMarket().withPath(`/site/${t}`).withEndpointIdentifier("/site/{lookupId}").withJsonContentType().send().then(e=>({...e,body:_.fromJSON(e.body)})))(V.n.getInstance(),e)),select:e=>e.body.site,staleTime:J,gcTime:B});if(r)throw a(r),r;const c=o.Ru.getLocaleForTranslation(),{data:u,error:h,isPending:S,isSuccess:E}=(0,k.I)({queryKey:q.siteMetadata(e,c),queryFn:n?.defaultLocale?async()=>{const t=await(async(e,t,a)=>await e.build().withHost(`${Z.sp}`).withMethod("GET").withoutMarket().withPath(`/sites/${t}/metadata/${a}`).withEndpointIdentifier("/sites/{lookupId}/metadata/{localeCode}").withJsonContentType().send().then(e=>({...e,body:M.fromJSON(e.body)})))(V.n.getInstance(),e,c);return s(),t}:D.hT,select:e=>e.body.metadata,enabled:!!n?.defaultLocale,staleTime:J,gcTime:B});if(h)throw a(h),h;return{site:n,isSiteSuccess:l,siteMetadata:u,isSiteMetadataSuccess:E,isPending:i||S}},x="wwZLLVSGwIShAgNVfFHA",H="I0xNi_PLcERYnQKxe_iK",j="KP7sWlHhcq6iDkXOcFTt";var F=a(86070);const $=()=>{const{lookupToken:e=""}=(0,n.g)(),{site:t,siteMetadata:a}=K(e);if(!t||!a)throw new Error(`[The Stage]: Missing data for site: ${e}`);y(t.url,t.clientId);const s=I(t.clientId),r=(()=>{const e=(0,u.k)();if(!e)return;const{containerVersion:t}=e;return t.substring(0,t.lastIndexOf("."))})();let i="";return t.url&&r&&(i=function(e,t,a){const s=new URL(e);s.searchParams.append("utm_app_version",t),a&&(s.hash=`#id_token=${a}`);return s.toString()}(t.url,r,s)),(0,F.jsx)("div",{className:x,children:(0,F.jsx)("iframe",{title:a.title,name:"stage-view-frame",id:H,src:i,sandbox:"allow-scripts allow-same-origin"})})};var Y=a(97500),W=a.n(Y),z=a(12627);var Q=a(78590),X=a(64352),ee=a(70684);const te=X.$S.PANEL_CLOSE_CLICK;var ae=a(43038);var se=a(70613);const ne=e=>{(()=>{const{scrollNodeChildRef:e}=(0,s.useContext)(z.bi);(0,s.useEffect)(()=>{const t=e?.current,a=e?.current?.className;return t&&(t.className=W()(a,j)),()=>{t&&(t.className=W()(a))}},[e])})(),(()=>{const{isActive:e,panelSend:t}=(0,Q.AI)(ee.Z.NowPlayingView);e&&t(te)})(),function(){const e=(0,ae.z)();e.getState()?.hasContext&&!e.getState()?.isPaused&&e.pause({featureIdentifier:"the-stage"})}();const{lookupToken:t=""}=(0,n.g)(),[a]=(0,s.useState)((0,r.A)());((e,t)=>{const a=(0,d.S)(e=>e.setStatus),n=(0,d.S)(e=>e.setSession),r=(0,d.S)(e=>e.resetSession),i=(0,s.useCallback)(a,[a]),o=(0,s.useCallback)(n,[n]),l=(0,s.useCallback)(r,[r]);(0,s.useEffect)(()=>(o({siteId:e,sessionId:t,startTime:Date.now()}),i(g.Z.PRESENTED),()=>{i(g.Z.DISMISSED),l()}),[l,o,i,t,e])})(t,a);const{isPending:u}=K(t);return(0,i.NC)(se.n2U)?(0,F.jsx)(l.s,{children:u?(0,F.jsx)(c.LoadingPage,{hasError:!1,errorMessage:o.Ru.get("error.generic")}):(0,F.jsx)($,{})}):(0,F.jsx)(c.LoadingPage,{hasError:!0,errorMessage:o.Ru.get("error.not_found.title.page")})}}}]);
//# sourceMappingURL=xpui-routes-stage-page.js.map